% =========================
% CORE MATH & SYMBOLS
% =========================
\usepackage{amsmath, amsfonts, amssymb}

% =========================
% PAGE LAYOUT
% =========================
\usepackage{geometry}
\geometry{a4paper, margin=1in}
\renewcommand{\baselinestretch}{2} % line spacing

% =========================
% FIGURES, TABLES & FLOATS
% =========================
\usepackage{graphicx}
\usepackage{adjustbox}              % resize boxes/tables that exceed \textwidth
\usepackage{subcaption}             % sub-figures
\usepackage[figuresright]{rotating} % sideways figures/tables
\usepackage{float}                  % improved float placement
\usepackage{booktabs, threeparttable}
\usepackage{dcolumn}
\usepackage{multirow}
\usepackage{diagbox}

% =========================
% TIKZ & DIAGRAMS
% =========================
\usepackage{tikz}
\usetikzlibrary{arrows.meta, positioning}

% =========================
% PDF & LINKS
% =========================
\usepackage{pdfpages}
\usepackage{url}      % robust URL typesetting for bib/footnotes
\usepackage{natbib}   % load before hyperref for compatibility
\usepackage{hyperref} % keep close to the end of package list

% =========================
% TEXT, QUOTES, UTILITIES
% =========================
\usepackage{dirtytalk}  % \say{}
\usepackage{bbm}        % \mathbbm{1}
\usepackage{lipsum}     % dummy text
\usepackage{setspace}   % fine-grained spacing control


\newenvironment{acknowledgments}
  {\renewcommand{\abstractname}{Acknowledgments}\begin{abstract}}
  {\end{abstract}}

\newenvironment{dedication}
  {\cleardoublepage \thispagestyle{empty} \vspace*{\fill} \begin{center}}
  {\end{center} \vspace*{\fill} \clearpage}


% =========================
% SECTIONING & NUMBERING
% =========================
\usepackage{titlesec}
\renewcommand{\thesection}{\thechapter.\arabic{section}} % show as X.1, X.2, ...
\setcounter{secnumdepth}{3}
\makeatletter
\@addtoreset{section}{chapter} % reset section counter at each chapter
\makeatother

% =========================
% PATCHES & CUSTOM ENVIRONMENTS
% =========================
\usepackage{xpatch}
\makeatletter
% Reduce default chapter top space (if using book/report)
\newlength{\chaptertopskip}
\setlength{\chaptertopskip}{10pt}
\xpatchcmd{\@makechapterhead}{\vspace*{50\p@}}{\vspace*{\chaptertopskip}}{\typeout{Success}}{\typeout{Failure!!!}}
\makeatother

% Dialogue environment customization
\usepackage{dialogue}
\makeatletter
\renewenvironment{dialogue}{%
  \begin{list}{}{%
    \setlength\itemsep{\z@ \@plus .5ex}%
    \setlength{\parsep}{\parskip}%
    \setlength{\rightmargin}{0pt}%
    \setlength{\labelsep}{0.5em}%
    \setlength{\leftmargin}{\labelwidth}%
    \addtolength{\leftmargin}{\labelsep}%
    % NOTE: If you intended a custom macro, consider \newcommand instead of \defcommand
    \defcommand\speak[2]{\item[\hfill {##1}] {\itshape ``{##2}''}}%
    \let\makelabel\DialogueLabel
  }%
  \PreDialogue\relax
}{%
  \end{list}%
}
\makeatother

% Footnote spacing tweak
\usepackage{etoolbox}
\makeatletter
\patchcmd{\@footnotetext}{\setspace@singlespace}{0.8}{}{}
\makeatother
\footnotesep=10pt

% =========================
% LOAD LAST
% =========================
\usepackage{subfiles} % Best loaded last in the preamble

\RequirePackage{silence}
\WarningFilter{etex}{Extended allocation already in use}